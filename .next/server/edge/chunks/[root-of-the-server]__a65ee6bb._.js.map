{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/utils/checkRule.ts"],"sourcesContent":["export enum UserRule {\r\n  admin = \"admin\",\r\n  dono = \"Dono\",\r\n  estoque = \"estoque\",\r\n  suportedosistema = \"suporte do sistema\",\r\n  cliente = \"cliente\",\r\n}\r\n\r\ninterface CheckRules {\r\n  canAccess(path: string): boolean;\r\n}\r\n\r\nclass SpecialAccess implements CheckRules {\r\n  canAccess(path: string): boolean {\r\n    return path.startsWith(\"/dashboard\");\r\n  }\r\n}\r\n\r\nclass ClientAccess implements CheckRules {\r\n  canAccess(path: string): boolean {\r\n    return path.startsWith(\"/catalogo\");\r\n  }\r\n}\r\n\r\nexport class AccessControl {\r\n  private strategy: CheckRules;\r\n\r\n  constructor(rule: UserRule) {\r\n    switch (rule) {\r\n      case UserRule.admin:\r\n      case UserRule.dono:\r\n      case UserRule.suportedosistema:\r\n        this.strategy = new SpecialAccess();\r\n        break;\r\n      case UserRule.cliente:\r\n        this.strategy = new ClientAccess();\r\n        break;\r\n      default:\r\n        throw new Error(\"Regra de usuÃ¡rio desconhecida\");\r\n    }\r\n  }\r\n\r\n  canAccess(path: string): boolean {\r\n    return this.strategy.canAccess(path);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAO,IAAA,AAAK,kCAAA;;;;;;WAAA;;AAYZ,MAAM;IACJ,UAAU,IAAY,EAAW;QAC/B,OAAO,KAAK,UAAU,CAAC;IACzB;AACF;AAEA,MAAM;IACJ,UAAU,IAAY,EAAW;QAC/B,OAAO,KAAK,UAAU,CAAC;IACzB;AACF;AAEO,MAAM;IACH,SAAqB;IAE7B,YAAY,IAAc,CAAE;QAC1B,OAAQ;YACN;YACA;YACA;gBACE,IAAI,CAAC,QAAQ,GAAG,IAAI;gBACpB;YACF;gBACE,IAAI,CAAC,QAAQ,GAAG,IAAI;gBACpB;YACF;gBACE,MAAM,IAAI,MAAM;QACpB;IACF;IAEA,UAAU,IAAY,EAAW;QAC/B,OAAO,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;IACjC;AACF"}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["// Next\r\nimport { NextResponse } from \"next/server\";\r\nimport type { NextRequest } from \"next/server\";\r\n\r\n// Utils\r\nimport { AccessControl, UserRule } from \"./utils/checkRule\";\r\n\r\nconst protectedRoutes = [\"/dashboard\"];\r\n\r\nfunction isProtectedRoute(pathname: string): boolean {\r\n  return protectedRoutes.some((router) => pathname.startsWith(router));\r\n}\r\n\r\nfunction redirectTo(path: string, req: NextRequest) {\r\n  return NextResponse.redirect(new URL(path, req.url));\r\n}\r\n\r\nfunction parseUserRule(access?: string): UserRule | undefined {\r\n  if (!access) return undefined;\r\n\r\n  try {\r\n    let rule = decodeURIComponent(access);\r\n    rule = rule\r\n      .trim()\r\n      .toLowerCase()\r\n      .replace(/[\\s\\-_]+/g, \"\");\r\n    rule = rule.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\r\n\r\n    const routesByAccessRule: Record<string, UserRule> = {\r\n      admin: UserRule.admin,\r\n      dono: UserRule.dono,\r\n      suportedosistema: UserRule.suportedosistema,\r\n      cliente: UserRule.cliente,\r\n      estoque: UserRule.estoque,\r\n    };\r\n\r\n    return routesByAccessRule[rule];\r\n  } catch (e) {\r\n    return undefined;\r\n  }\r\n}\r\n\r\nexport function middleware(req: NextRequest) {\r\n  const token = req.cookies.get(\"auth_token\")?.value;\r\n  const cookieRule = req.cookies.get(\"user_rule\")?.value;\r\n  const userRule = parseUserRule(cookieRule);\r\n\r\n  const pathname = req.nextUrl.pathname;\r\n  const protectedRoute = isProtectedRoute(pathname);\r\n\r\n  if (!token || !userRule) {\r\n    if (pathname === \"/forbidden\") {\r\n      return redirectTo(\"/\", req);\r\n    }\r\n    return protectedRoute ? redirectTo(\"/signin\", req) : NextResponse.next();\r\n  }\r\n\r\n  if (pathname === \"/signin\") {\r\n    let redirectPath = \"/catalogo\";\r\n\r\n    switch (userRule) {\r\n      case UserRule.admin:\r\n      case UserRule.dono:\r\n      case UserRule.suportedosistema:\r\n        redirectPath = \"/dashboard\";\r\n        break;\r\n      case UserRule.cliente:\r\n        redirectPath = \"/catalogo\";\r\n        break;\r\n      case UserRule.estoque:\r\n        redirectPath = \"/estoque\";\r\n        break;\r\n    }\r\n\r\n    return redirectTo(redirectPath, req);\r\n  }\r\n\r\n  const accessControl = new AccessControl(userRule);\r\n  const canAccess = accessControl.canAccess(pathname);\r\n\r\n  if (protectedRoute && !canAccess) {\r\n    return redirectTo(\"/forbidden\", req);\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const settings = {\r\n  matcher: [\"/dashboard/:path*\", \"/catalogo/:path*\", \"/dono/:path*\", \"/signin\"],\r\n};\r\n"],"names":[],"mappings":"AAAA,OAAO;;;;;AACP;AAAA;AAGA,QAAQ;AACR;;;AAEA,MAAM,kBAAkB;IAAC;CAAa;AAEtC,SAAS,iBAAiB,QAAgB;IACxC,OAAO,gBAAgB,IAAI,CAAC,CAAC,SAAW,SAAS,UAAU,CAAC;AAC9D;AAEA,SAAS,WAAW,IAAY,EAAE,GAAgB;IAChD,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,MAAM,IAAI,GAAG;AACpD;AAEA,SAAS,cAAc,MAAe;IACpC,IAAI,CAAC,QAAQ,OAAO;IAEpB,IAAI;QACF,IAAI,OAAO,mBAAmB;QAC9B,OAAO,KACJ,IAAI,GACJ,WAAW,GACX,OAAO,CAAC,aAAa;QACxB,OAAO,KAAK,SAAS,CAAC,OAAO,OAAO,CAAC,oBAAoB;QAEzD,MAAM,qBAA+C;YACnD,OAAO,0HAAA,CAAA,WAAQ,CAAC,KAAK;YACrB,MAAM,0HAAA,CAAA,WAAQ,CAAC,IAAI;YACnB,kBAAkB,0HAAA,CAAA,WAAQ,CAAC,gBAAgB;YAC3C,SAAS,0HAAA,CAAA,WAAQ,CAAC,OAAO;YACzB,SAAS,0HAAA,CAAA,WAAQ,CAAC,OAAO;QAC3B;QAEA,OAAO,kBAAkB,CAAC,KAAK;IACjC,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAEO,SAAS,WAAW,GAAgB;IACzC,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe;IAC7C,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc;IACjD,MAAM,WAAW,cAAc;IAE/B,MAAM,WAAW,IAAI,OAAO,CAAC,QAAQ;IACrC,MAAM,iBAAiB,iBAAiB;IAExC,IAAI,CAAC,SAAS,CAAC,UAAU;QACvB,IAAI,aAAa,cAAc;YAC7B,OAAO,WAAW,KAAK;QACzB;QACA,OAAO,iBAAiB,WAAW,WAAW,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IACxE;IAEA,IAAI,aAAa,WAAW;QAC1B,IAAI,eAAe;QAEnB,OAAQ;YACN,KAAK,0HAAA,CAAA,WAAQ,CAAC,KAAK;YACnB,KAAK,0HAAA,CAAA,WAAQ,CAAC,IAAI;YAClB,KAAK,0HAAA,CAAA,WAAQ,CAAC,gBAAgB;gBAC5B,eAAe;gBACf;YACF,KAAK,0HAAA,CAAA,WAAQ,CAAC,OAAO;gBACnB,eAAe;gBACf;YACF,KAAK,0HAAA,CAAA,WAAQ,CAAC,OAAO;gBACnB,eAAe;gBACf;QACJ;QAEA,OAAO,WAAW,cAAc;IAClC;IAEA,MAAM,gBAAgB,IAAI,0HAAA,CAAA,gBAAa,CAAC;IACxC,MAAM,YAAY,cAAc,SAAS,CAAC;IAE1C,IAAI,kBAAkB,CAAC,WAAW;QAChC,OAAO,WAAW,cAAc;IAClC;IAEA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,WAAW;IACtB,SAAS;QAAC;QAAqB;QAAoB;QAAgB;KAAU;AAC/E"}}]
}