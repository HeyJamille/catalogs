{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file://C%3A/projetos/catalogs/provider/auth.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useRouter } from \"next/navigation\";\r\n\r\n// Utils\r\nimport { setupApiClient } from \"@/utils/fetchData\";\r\n\r\n// Context\r\nimport { createContext, ReactNode, useState } from \"react\";\r\n\r\n// Cookie\r\nimport Cookies from \"js-cookie\";\r\n\r\n// Types\r\nimport { itemUsers } from \"../types/users/index\";\r\n\r\n// Tipagens\r\ntype SignInProps = {\r\n  email: string;\r\n  password: string;\r\n};\r\n\r\ntype SignInResponse = {\r\n  user: itemUsers;\r\n  token: string;\r\n};\r\n\r\ntype AuthContextData = {\r\n  user: itemUsers | undefined;\r\n  token: string;\r\n  signIn: (credentials: SignInProps) => Promise<SignInResponse>;\r\n  signOut: () => void;\r\n};\r\n\r\nexport const AuthContext = createContext({} as AuthContextData);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n  const [user, setUser] = useState<itemUsers>();\r\n  const [token, setToken] = useState<string>(\"\");\r\n\r\n  const api = setupApiClient();\r\n  const router = useRouter();\r\n\r\n  async function signIn({\r\n    email,\r\n    password,\r\n  }: SignInProps): Promise<SignInResponse> {\r\n    try {\r\n      const resp = await api.post(\"/users/signin\", { email, password });\r\n      if (!resp) throw new Error(\"Credenciais inv√°lidas\");\r\n\r\n      const token = resp.data.token;\r\n      const user = resp.data.user;\r\n      const userRuleName = user.rule.name.toLowerCase();\r\n\r\n      Cookies.set(\"auth_token\", token);\r\n      Cookies.set(\"user_rule\", userRuleName);\r\n\r\n      setUser(user);\r\n      setToken(token);\r\n      api.defaults.headers[\"Authorization\"] = `Bearer ${token}`;\r\n\r\n      // Rule-based redirection\r\n      const routeByRule: Record<string, string> = {\r\n        admin: \"/dashboard\",\r\n        dono: \"/dashboard\",\r\n        suportedosistema: \"/dashboard\",\r\n        cliente: \"/catalogo\",\r\n        estoque: \"/estoque\",\r\n      };\r\n\r\n      router.push(routeByRule[userRuleName] || \"/\");\r\n\r\n      return { user, token };\r\n    } catch (err) {\r\n      console.log(\"error: \", err);\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  async function signOut() {\r\n    Cookies.remove(\"auth_token\");\r\n    Cookies.remove(\"user_rule\");\r\n    setUser(undefined);\r\n    setToken(\"\");\r\n    router.push(\"/signin\");\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, token, signIn, signOut }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;;;;;AAKA,UAAU;AACV;AAEA,SAAS;AACT;AAXA;;;;;;AAkCO,MAAM,4BAAc,CAAA,GAAA,qMAAA,CAAA,gBAAa,AAAD,EAAE,CAAC;AAEnC,SAAS,aAAa,EAAE,QAAQ,EAA2B;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD;IAC/B,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAU;IAE3C,MAAM,MAAM;IACZ,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IAEvB,eAAe,OAAO,EACpB,KAAK,EACL,QAAQ,EACI;QACZ,IAAI;YACF,MAAM,OAAO,MAAM,IAAI,IAAI,CAAC,iBAAiB;gBAAE;gBAAO;YAAS;YAC/D,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;YAE3B,MAAM,QAAQ,KAAK,IAAI,CAAC,KAAK;YAC7B,MAAM,OAAO,KAAK,IAAI,CAAC,IAAI;YAC3B,MAAM,eAAe,KAAK,IAAI,CAAC,IAAI,CAAC,WAAW;YAE/C,qJAAA,CAAA,UAAO,CAAC,GAAG,CAAC,cAAc;YAC1B,qJAAA,CAAA,UAAO,CAAC,GAAG,CAAC,aAAa;YAEzB,QAAQ;YACR,SAAS;YACT,IAAI,QAAQ,CAAC,OAAO,CAAC,gBAAgB,GAAG,CAAC,OAAO,EAAE,OAAO;YAEzD,yBAAyB;YACzB,MAAM,cAAsC;gBAC1C,OAAO;gBACP,MAAM;gBACN,kBAAkB;gBAClB,SAAS;gBACT,SAAS;YACX;YAEA,OAAO,IAAI,CAAC,WAAW,CAAC,aAAa,IAAI;YAEzC,OAAO;gBAAE;gBAAM;YAAM;QACvB,EAAE,OAAO,KAAK;YACZ,QAAQ,GAAG,CAAC,WAAW;YACvB,MAAM;QACR;IACF;IAEA,eAAe;QACb,qJAAA,CAAA,UAAO,CAAC,MAAM,CAAC;QACf,qJAAA,CAAA,UAAO,CAAC,MAAM,CAAC;QACf,QAAQ;QACR,SAAS;QACT,OAAO,IAAI,CAAC;IACd;IAEA,qBACE,8OAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAO;YAAQ;QAAQ;kBACzD;;;;;;AAGP","debugId":null}}]
}