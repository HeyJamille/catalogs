{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/projetos/catalogs/utils/api/fetchData.ts"],"sourcesContent":["// Biblioteca\r\nimport axios from \"axios\";\r\n\r\nexport function setupApiClient(token?: string) {\r\n  const api = axios.create({\r\n    baseURL: \"https://catalogsapi.vercel.app/v1\",\r\n    validateStatus: (status) => status < 500,\r\n  });\r\n\r\n  api.interceptors.request.use(\r\n    (config) => {\r\n      if (token) {\r\n        config.headers.Authorization = `Bearer ${token}`;\r\n      }\r\n      return config;\r\n    },\r\n    (err) => {\r\n      return Promise.reject(err);\r\n    }\r\n  );\r\n\r\n  return api;\r\n}\r\n"],"names":[],"mappings":"AAAA,aAAa;;;;AACb;;AAEO,SAAS,eAAe,KAAc;IAC3C,MAAM,MAAM,wIAAA,CAAA,UAAK,CAAC,MAAM,CAAC;QACvB,SAAS;QACT,gBAAgB,CAAC,SAAW,SAAS;IACvC;IAEA,IAAI,YAAY,CAAC,OAAO,CAAC,GAAG;8BAC1B,CAAC;YACC,IAAI,OAAO;gBACT,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;YAClD;YACA,OAAO;QACT;;8BACA,CAAC;YACC,OAAO,QAAQ,MAAM,CAAC;QACxB;;IAGF,OAAO;AACT","debugId":null}},
    {"offset": {"line": 41, "column": 0}, "map": {"version":3,"sources":["file://C%3A/projetos/catalogs/provider/auth.tsx"],"sourcesContent":["\"use client\";\r\n\r\n// Next\r\nimport { useRouter } from \"next/navigation\";\r\n\r\n// Utils\r\nimport { setupApiClient } from \"@/utils/api/fetchData\";\r\n\r\n// Context\r\nimport { createContext, ReactNode, useEffect, useState } from \"react\";\r\n\r\n// Bibliotecas\r\nimport Cookies from \"js-cookie\";\r\nimport { addToast, ToastProvider } from \"@heroui/react\";\r\nimport { useTopLoader } from \"nextjs-toploader\";\r\n\r\n// Tipagem\r\nimport { itemUsers } from \"../types/user\";\r\n\r\n// Tipagens\r\ntype SignInProps = {\r\n  email: string;\r\n  password: string;\r\n};\r\n\r\ntype AuthContextData = {\r\n  user: itemUsers | undefined;\r\n  signIn: (credentials: SignInProps) => Promise<string>;\r\n  signOut: () => void;\r\n};\r\n\r\nexport const AuthContext = createContext({} as AuthContextData);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n  const [user, setUser] = useState<itemUsers>();\r\n\r\n  const router = useRouter();\r\n  const loader = useTopLoader();\r\n\r\n  async function signIn({ email, password }: SignInProps) {\r\n    try {\r\n      const api = setupApiClient();\r\n\r\n      const resp = await api.post(\"/users/signin\", { email, password });\r\n\r\n      if (resp.status === 200 || resp.status === 201) {\r\n        addToast({\r\n          title: \"Login realizado com sucesso!\",\r\n          description: \"Você será redirecionado em instantes.\",\r\n          variant: \"solid\",\r\n          color: \"success\",\r\n          classNames: {\r\n            title: \"text-white\",\r\n            description: \"text-gray-100\",\r\n            icon: \"text-white\",\r\n          },\r\n        });\r\n      } else if (resp.status == 500) {\r\n        addToast({\r\n          title: \"Erro no servidor\",\r\n          description: \"Tente novamente mais tarde.\",\r\n          variant: \"flat\",\r\n          color: \"danger\",\r\n        });\r\n      } else {\r\n        addToast({\r\n          title: \"Erro ao fazer login\",\r\n          description:\r\n            resp.data.message ||\r\n            \"Verifique suas credenciais e tente novamente.\",\r\n          variant: \"flat\",\r\n          color: \"danger\",\r\n        });\r\n      }\r\n\r\n      setUser(resp.data.user && resp.data.user);\r\n\r\n      resp.data.token && Cookies.set(\"auth_token\", resp.data.token);\r\n      resp.data.user.rule.name &&\r\n        Cookies.set(\"user_rule\", resp.data.user.rule.name);\r\n\r\n      api.defaults.headers[\"Authorization\"] = `Bearer ${resp.data.token}`;\r\n\r\n      const routeByRule: Record<string, string> = {\r\n        Admin: \"/dashboard\",\r\n        Dono: \"/dashboard\",\r\n        \"Suporte do Sistema\": \"/dashboard\",\r\n        Cliente: \"/catalogo\",\r\n        Estoque: \"/estoque\",\r\n      };\r\n\r\n      loader.start();\r\n      resp.data.user && router.push(routeByRule[resp.data.user.rule.name]);\r\n    } catch (err: any) {\r\n      return err;\r\n    }\r\n  }\r\n\r\n  async function signOut() {\r\n    Cookies.remove(\"auth_token\");\r\n    Cookies.remove(\"user_rule\");\r\n\r\n    setUser(undefined);\r\n\r\n    router.push(\"/signin\");\r\n  }\r\n\r\n  useEffect(() => {\r\n    const token = Cookies.get(\"auth_token\");\r\n\r\n    async function loadUser() {\r\n      if (token) {\r\n        try {\r\n          const api = setupApiClient(token);\r\n\r\n          const resp = await api.get(\"/users/me\");\r\n\r\n          setUser(resp.data.user);\r\n        } catch (err) {\r\n          console.log(\"Erro ao validar token:\", err);\r\n\r\n          signOut();\r\n        }\r\n      }\r\n    }\r\n\r\n    loadUser();\r\n  }, []);\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, signIn, signOut }}>\r\n      {children}\r\n      <ToastProvider placement=\"top-right\" toastOffset={20} />\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}